name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Validate repository structure
        run: |
          echo "Validating repository structure..."
          if [ -f "README.md" ]; then
            echo "✓ README.md exists"
          else
            echo "✗ README.md not found"
            exit 1
          fi
      
      - name: Check branch protection files
        run: |
          echo "Checking branch protection files..."
          if [ -f ".github/CODEOWNERS" ]; then
            echo "✓ CODEOWNERS file exists"
          else
            echo "✗ CODEOWNERS file not found"
            exit 1
          fi
          
          if [ -f ".github/rulesets/main-branch-protection.json" ]; then
            echo "✓ Branch protection ruleset exists"
          else
            echo "✗ Branch protection ruleset not found"
            exit 1
          fi
      
      - name: Validate JSON files
        run: |
          echo "Validating JSON configuration files..."
          for file in .github/rulesets/*.json; do
            if [ -f "$file" ]; then
              echo "Validating $file..."
              if python3 -m json.tool "$file" > /dev/null 2>&1; then
                echo "✓ $file is valid JSON"
              else
                echo "✗ $file is invalid JSON"
                exit 1
              fi
            fi
          done
      
      - name: Build status
        run: |
          echo "All checks passed successfully!"
